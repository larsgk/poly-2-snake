<link rel="import" href="bower_components/polymer/polymer-element.html">
<link rel="import" href="bower_components/paper-button/paper-button.html">
<link rel="import" href="poly-snake-part.html">
<link rel="import" href="hexa-snake.html">
<link rel="import" href="audio-mixin.html">

<dom-module id="poly-snake">
  <template>
  <h2>[[direction]]</h2>

  <canvas id="canvas" width="512" height="512"></canvas>

    <dom-repeat items="[[snake]]">
      <template><poly-snake-part data="[[item]]" ctx="[[ctx]]"></poly-snake-part><br></template>
    </dom-repeat>
  </template>

  <script>

    const _KEY_DIR = {
      "KeyD":   0,
      "KeyE":  60,
      "KeyW": 120,
      "KeyA": 180,
      "KeyZ": 240,
      "KeyX": 300 
    };

    class PolySnake extends AudioMixin(HexaSnake(Polymer.Element)) {
      static get is() { return 'poly-snake' }

      static get config() {
        return {
          properties: {
          }
        };
      }

      connectedCallback() {
        super.connectedCallback();

        this.notifyPath('snake');

        setInterval(_ => {
          this.move(false);
        }, 250);

        this.ctx = this.$.canvas.getContext('2d');

        requestAnimationFrame(this._installListeners.bind(this));
      }

      _installListeners() {
        this.generateGrid(8);
        console.log("grid", this.grid);

        console.log(document);
        document.addEventListener('keydown', evt => {
          if(!evt.repeat) {
            console.log('down', evt);
            const dir = _KEY_DIR[evt.code];
            if(dir !== undefined) {
                this.changeDirection(dir);
                // this.playEffect('splash'); // base on event
            }
          }
        });
        document.addEventListener('keyup', evt => {
          console.log('up', evt);
        });

        // load sounds
        this.loadEffect('./splash1.ogg', 'splash')
      }

      render() {
        // render the grid
      }
    }

    customElements.define(PolySnake.is, PolySnake);

  </script>
</dom-module>
